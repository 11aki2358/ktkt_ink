<!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns#">
<head>
<meta name="robots" content="noindex,nofollow">
<meta name="googlebot" content="noindex,nofollow">
<meta name="pinterest" content="nopin">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#000000">
<link rel="shortcut icon" href="../images/favicon.svg" type="image/svg+xml">
<title>backyard</title>
<link rel="stylesheet" href="../css/prism.css" type="text/css" id="style">
<link rel="stylesheet" href="../css/decoration.css" type="text/css" id="style">
<link rel="stylesheet" href="../css/footer.css" type="text/css" id="style">
<link rel="stylesheet" href="../css/image.css" type="text/css" id="style">
<link rel="stylesheet" href="../css/style.css" type="text/css" id="style">
</head>
<body>
<header>
<nav>
<div class="header-logo-menu">
<div class="logo-area">
<h1><a href="./backyard.html">backyard</a></h1>
</div>
<div id="nav-drawer">
<input id="nav-input" type="checkbox" class="nav-unshown">
<label id="nav-open" for="nav-input"><span></span></label>
<label class="nav-unshown" id="nav-close" for="nav-input"></label>
<div id="nav-content-record"></div>
<div id="nav-content-jacket">
<div class="nav-content-text center-list"></div>
</div>
</div>
</div>
</div>
</nav>
</header>
<main>
<!-- CSS : prism -->
<!-- genre : design -->
<h2 id="access-limitation">Access Limitation</h2>
<p>Netlifyでデプロイする静的サイトでは、Basic認証や.htaccessによる制限ができない。<br>それでもなんとかして「ヤバいイラスト」に閲覧制限をかける方法を模索している記録。  </p>
<p>頑張ってみているけれど、車輪の再発明にすぎないんだろうなぁ...</p>
<h2 id="abstract">Abstract</h2>
<p>実装したい機能</p>
<ul>
<li>パスワード認証が出来る。複数の秘密ページで、同じパスワードを使いまわせる。</li>
<li>パスワードを入力しなければ、デベロッパツール等を使用しても秘密ページの中身を見ることは出来ない。</li>
<li>パスワードを入力しなければ、秘密ページのURLを知ることは出来ない。</li>
<li>パスワードが間違っていた場合でも、おかしな挙動をしない</li>
</ul>
<p>(DEMO-0の仕組みは、この全体像に当てはまらない)</p>
<h3 id="-url-">「パスワードを入力しなければ、秘密ページのURLを知ることは出来ない」</h3>
<p>秘密ページのurlは秘密にする、ということ。
パスワードが分らなくてもとりあえず秘密ページのURLにはアクセスできる、という状態だと...<br>デベロッパーツールや「Ctr-U(ページのソースを表示)」を使って本文や画像を覗き見できる。
「パスワードがわかる人でなければ、秘密ページのURLが分らない」というのが必要。</p>
<h3 id="password-page">Password Page</h3>
<p>パスワード入力ページ。urlは任意。<br>秘密ページと一対一対応。
パスワードが正しければ、秘密ページに飛ぶ。</p>
<h3 id="secret-page">Secret Page</h3>
<p>秘密ページ。ヤバいイラスト。秘密ページ毎のidがurlに使われている。idがバレたらurlがバレる。<br><a href="https://okwave.jp/qa/q4880306.html" target="_blank">こちら</a>の<br>『「main.html」に以下のJavaScriptを記載します』<br>以降の部分を使い <strong>このページに至るパスワード入力ページ</strong> 以外からのアクセスを弾く。  </p>
<h2 id="demo-0">DEMO-0</h2>
<p><strong>prompt関数を使ってパスワードを入力</strong><br>prompt関数でパスワード入力ページを表示し、正しいパスワードだったらページの内容を表示する(パスワード入力ページ = 秘密ページ)</p>
<p><a href="design-limitation-pass0.html">秘密ページ</a></p>
<p>きちんと機能しているときには、真っ白な背景にパスワード入力枠だけが表示される。<br>この状態でデベロッパーツールを起動しても、何も表示されない。</p>
<h3 id="-">難点</h3>
<p><strong>Ctr-U</strong>(ソースの表示)を押すと、htmlが表示される。パスワードが分らなくても本文を読めてしまう(だから、秘密ページのURLを秘密にする必要がある)。<br>あと、パスワード入力枠の背景にページ本文が透けて見えてしまうことがたまにある。
とてもマズい。  </p>
<h2 id="demo-1">DEMO-1</h2>
<p><strong>パスワード入力ページと秘密ページは別</strong></p>
<p><a href="design-limitation-pass1.html">パスワード入力ページ</a></p>
<ul>
<li>パスワード入力ページ : dsign-limitation-pass1.html</li>
<li>秘密ページ : design-limitation-secret.html(idがdesign-limitation-secret)<br>ただし、「パスワード入力ページ以外からのアクセスを弾く」は実装していない。</li>
</ul>
<h3 id="-">難点</h3>
<p>パスワード入力ページの下部に書かれたjavaScriptを見れば、パスワードも、秘密ページのurlも分かってしまう。</p>
<h2 id="demo-2">DEMO-2</h2>
<p><strong>パスワード入力ページでAES暗号を使用</strong></p>
<p>パスワード入力ページのソースコードを見ても、秘密ページのURLは分らない(当然、パスワードも分からない)。</p>
<p><a href="design-limitation-pass2.html">パスワード入力ページ(改)</a></p>
<ul>
<li>パスワード入力ページ : design-limitation-pass2.html</li>
<li>秘密ページ : design-limitation-secret.html(idがdesign-limitation-secret)<br>ただし、「11aki2358以外からのアクセスを弾く」は実装していない。</li>
</ul>
<p><a href="https://chakkari.org/blog/2020/05/03/aes-encrypt-with-javascript/" target="_blank">AES暗号</a>
と
<a href="http://www.imymode.com/exp/js02.htm" target="_blank">javaScriptの小細工</a>を使う
(AES暗号用のjavaScriptをパスワード入力ページに読みこむ必要がある)。  </p>
<p><em>準備</em></p>
<ul>
<li>秘密ページのidを、<a href="design-limitation-coding.html">コレ</a> で暗号化。<br>今回は、design-limitation-secret.htmlのid「design-limitation-secret」を、パスワード「key」で暗号化。</li>
<li>暗号文U2Fsd...3cFk+(長ったらしい)を得た。</li>
<li>パスワード入力ページ(改)(design-limitation-pass2.html)に、この暗号文を仕込む。</li>
</ul>
<p><em>パスワードの認証</em></p>
<ul>
<li>パスワード入力ページ(改)に入力されたパスワードを使って、この長ったらしい暗号文を復号。</li>
<li>復号した値を、変数txt_decryptedに格納</li>
<li>txt_decrypted + &quot;.html&quot;にアクセス</li>
</ul>
<h3 id="-">難点</h3>
<p>間違えたパスワードを入力した場合、存在しないurlに飛ばされる(AES暗号の復号に失敗するので)。<br>エラー404ページまで飛ばされた後、パスワード再入力まで行くのが面倒。</p>
<h2 id="demo-3">DEMO-3</h2>
<p>パスワードの正誤を確認するためのハッシュ化を行う</p>
<p><em>準備</em></p>
<ul>
<li>パスワード&#39;key&#39;を事前にハッシュ化しておく。このハッシュ値を、定数<code>test_hash</code>に格納</li>
<li>id(秘密ページのURL)を、パスワード&#39;key&#39;を使ってAES暗号化。暗号化した値を、定数<code>encrypted</code>に格納</li>
<li>文字列<code>test_hash</code>, <code>encrypted</code>をパスワード認証ページに仕込む。</li>
<li>ハッシュ化と暗号化のための仕掛け : <a href="../works/work-encode.html">リンク</a></li>
<li>ログインページ : <a href="../works/work-20260208.html">リンク</a><br>詳しくは、上記リンク先に書かれたメモと、ページに仕込まれたjavascriptを参照。</li>
</ul>
<p><em>認証</em></p>
<ul>
<li>パスワード認証ページに入力された値をハッシュ化する。ハッシュ値を<code>pass_hash</code>に格納</li>
<li><code>test_hash</code>と<code>pass_hash</code>が一致 = 入力されたパスワードは正しい<ul>
<li>入力されたパスワードを使って<code>encrypted</code>を復号する。</li>
<li>この復号語を、変数<code>txt_dexrypted</code>に格納</li>
<li><code>txt_dexrypted</code> + &quot;.html&quot;にアクセス</li>
</ul>
</li>
<li><code>test_hash</code>と<code>pass_hash</code>が一致しなかった = パスワード間違えてる<ul>
<li>入力フォームをクリア(パスワード再入力を促す)</li>
</ul>
</li>
</ul>
<h2 id="-">もっと強固な方法</h2>
<p>.htaccessによる制御や、BASICによる閲覧制限。<br>おそらくNetlifyでは使えない。<br>Vercel(GitHub連携可)ではBasic認証が使える??? :
<a href="https://blog.kimizuka.org/entry/2021/06/09/231526" target="_blank">link</a></p>
<p>javascriptによる閲覧制限は、しょせんはお遊びのようなものなので...<br>絶対に見られたらマズい諸々は、サーバ/ホスティングサービスの機能に合わせて閲覧制限しておくこと。</p>
<p>以下、未実装</p>
<h3 id="-">セッション認証(フォーム認証)</h3>
<p>Netlifyでは使えない(php)</p>
<ul>
<li>phpことはじめ :
<a href="https://programmer-life.work/php/visual-studio-code-php" target="_blank">link</a><br><a href="https://github.com/juicyfx/vercel-php#-vercel-dev" target="_blank">link</a></li>
<li>フォーム認証(セッション認証)<br>データベースを用意する必要はない(ユーザ名やパスワード、ハッシュ化あれこれもphpに記されている)。
リダイレクトあれこれも、全てphpで行う(リダイレクトにvercel.json不要) :
<a href="https://qiita.com/mpyw/items/bb8305ba196f5105be15" target="_blank">link</a></li>
<li>上記資料では、login.phpで認証成功後ははindex.phpにしか飛べない。たぶん。<br>work04.php→ログインのためにlogin.phpにリダイレクト→login.phpで認証→work04.phpに戻る、的な機能は「php ページ間 データ 受け渡し」とかでググればたぶん実装できる。</li>
<li><p>詳細  :<br>Vercelでphpを使うためには、vercel.jsonの設定が必要。<br>phpファイルは、ルートディレクトリ直下のディレクトリapiの中に入れる。</p>
<ul>
<li><p>詳細 :
<a href="https://github.com/juicyfx/vercel-php" target="_blank">link</a><br>How to develop locally?<br>I think the best way at this moment is use PHP Development Server.  </p>
<pre><code class="language-powershell">
  php -S localhost:8000 api/index.php
</code></pre>

<p>phpインストールは必須かなぁ</p>
</li>
<li>▲Vercel で PHP を使う。 :
<a href="https://balloon.asia/2020/12/vercel-%E3%81%A7-php-%E3%82%92%E4%BD%BF%E3%81%86/" target="_blank">link</a></li>
</ul>
</li>
</ul>
</main>
<footer>
<button id="back-to-top"></button>
<nav><ul>
<li><a href="../index.html" class="btn-flat"><span>home</span></a></li>
<li><a href="./backyard.html" class="btn-flat"><span>backyard</span></a></li>
<li><a href="./design.html" class="btn-flat"><span>design</span></a></li>
</ul></nav>
</footer>
<script src="../js/prism.js"></script>
<script src="../js/general.js"></script>
</body>
</html>